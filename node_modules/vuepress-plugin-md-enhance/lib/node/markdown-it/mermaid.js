"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mermaid = void 0;
const hash = require("hash-sum");
const mermaidRender = (tokens, index) => {
    const token = tokens[index];
    const key = `mermaid-${hash(index)}`;
    const { content } = token;
    return `<Mermaid id="${key}" code="${encodeURIComponent(content)}"></Mermaid>`;
};
// a hack for sequenceDiagram
const mermaidHackRender = (name, content, index) => `<Mermaid id="mermaid-${hash(index)}" code="${encodeURIComponent(`${name}\n${content
    .split("\n")
    .map((line) => (line ? `  ${line}` : ""))
    .join("\n")}`)}"></Mermaid>`;
const mermaid = (md) => {
    // Handle ```mermaid blocks
    const fence = md.renderer.rules.fence;
    md.renderer.rules.fence = (...args) => {
        const [tokens, index] = args;
        const { content, info } = tokens[index];
        if (info.trim() === "mermaid")
            return mermaidRender(...args);
        if (info.trim() === "sequence")
            return mermaidHackRender("sequenceDiagram", content, index);
        if (info.trim() === "class")
            return mermaidHackRender("classDiagram", content, index);
        if (info.trim() === "state")
            return mermaidHackRender("stateDiagram-v2", content, index);
        if (info.trim() === "er")
            return mermaidHackRender("erDiagram", content, index);
        if (info.trim() === "journey")
            return mermaidHackRender("journey", content, index);
        if (info.trim() === "gantt")
            return mermaidHackRender("gantt", content, index);
        if (info.trim() === "pie")
            return mermaidHackRender("pie", content, index);
        if (info.trim() === "git-graph")
            return mermaidHackRender("gitGraph", content, index);
        return fence(...args);
    };
    md.renderer.rules["mermaid"] = mermaidRender;
};
exports.mermaid = mermaid;
//# sourceMappingURL=mermaid.js.map